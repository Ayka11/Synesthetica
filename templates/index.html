<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Synesthetica - Paint with Sound</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
            font-family: "Inter", Arial, sans-serif;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
      }
      main {
        flex: 1 0 auto;
      }
      footer {
        flex-shrink: 0;
      }
      header {
        font-family: "Inter", Arial, sans-serif;
        align-items: flex-start;
        position: sticky;
        top: 0;
        z-index: 1000;
      }
      header > div:first-child {
        margin-top: -0.3rem;
      }
      header nav a,
      header div a {
        transition: all 0.2s ease-in-out;
      }
      header nav a:hover,
      header div a:active {
        background-color: #f3f4f6;
        transform: translateY(-1px);
      }
      .brush-preview {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .brush-preview:hover,
      .brush-preview:active {
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      #bb {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 5px;
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 12px;
      }
      canvas {
        border: 2px solid #333;
        margin-top: 10px;
        background-color: #fff;
        width: 100%;
        max-width: 100%;
        height: auto;
        touch-action: none;
      }
      #toolSections {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin-bottom: 10px;
        width: 100%;
      }
      .tool-box {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 8px;
        background-color: #fefefe;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 5px;
      }
      #colorButtons {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        justify-content: center;
      }
      #colorButtons button {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 2px solid #444;
      }
      .tool-box input,
      .tool-box select,
      .tool-box button {
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #aaa;
        color: #000000;
        font-size: 14px;
        touch-action: manipulation;
      }
      .tool-box button:hover,
      .tool-box button:active {
        background-color: #d9d9d9;
      }
      #actionButtons {
        margin-top: 10px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
      }
      #actionButtons button {
        padding: 8px 12px;
        font-size: 14px;
        border: 1px solid #444;
        border-radius: 8px;
        background-color: #eee;
        color: #000000;
        transition: background-color 0.2s ease;
      }
      #actionButtons button:hover,
      #actionButtons button:active {
        background-color: #d9d9d9;
      }
      #infoBox {
        position: relative;
        text-align: center;
        margin-top: 8px;
      }
      #infoContent {
        display: none;
        background: #fff;
        color: #000;
        border: 1px solid #ccc;
        padding: 8px;
        width: 90%;
        max-width: 500px;
        font-size: 12px;
        line-height: 1.4;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        z-index: 10;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }
      #infoBox:hover #infoContent,
      #infoBox:active #infoContent {
        display: block;
      }
      #infoBox span {
        cursor: pointer;
        font-size: 18px;
      }
      #brushPreviewSection {
        display: none;
        width: 100%;
        max-width: 100%;
        margin: 0 auto;
        padding: 0 10px;
        transition: opacity 0.3s ease;
        opacity: 0;
      }
      #brushPreviewSection:not(.hidden) {
        display: block;
        margin-top: 10px;
        padding-bottom: 3rem;
        opacity: 1;
      }
      #seeMoreLink,
      #seeLessLink {
        color: #1a73e8;
        cursor: pointer;
        text-decoration: underline;
      }
      #seeMoreLink:hover,
      #seeMoreLink:active,
      #seeLessLink:hover,
      #seeLessLink:active {
        color: #1557b0;
      }
      #drawing-app {
        display: none;
        transition: opacity 0.3s ease;
      }
      #drawing-app.visible {
        display: block;
        opacity: 1;
      }
      .toast {
        background-color: #fefefe;
        border: 1px solid #ccc;
        border-radius: 8px;
        min-width: 200px;
      }
      .toast-header {
        background-color: #f0f0f0;
        color: #000000;
        font-size: 12px;
      }
      .toast-body {
        color: #000000;
        font-size: 12px;
        padding: 10px;
      }
      #chatButton {
        position: fixed;
        bottom: 15px;
        right: 15px;
        background-color: #1a73e8;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease, background-color 0.3s ease;
        z-index: 1000;
        border: none;
        cursor: pointer;
      }
      #chatButton:hover,
      #chatButton:active {
        transform: scale(1.1);
        background-color: #1557b0;
      }
      #chatWindow {
        position: fixed;
        bottom: 70px;
        right: 10px;
        width: 90%;
        max-width: 320px;
        height: 400px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        display: none;
        flex-direction: column;
        z-index: 1001;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #chatHeader {
        background-color: #1a73e8;
        color: white;
        padding: 10px;
        text-align: center;
        font-weight: bold;
        font-size: 14px;
        position: relative;
      }
      #chatClose {
        position: absolute;
        right: 10px;
        top: 10px;
        background: none;
        border: none;
        color: white;
        font-size: 18px;
        cursor: pointer;
      }
      #chatMessages {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        background-color: #fff;
      }
      .message {
        margin-bottom: 8px;
        padding: 8px;
        border-radius: 10px;
        max-width: 80%;
        word-wrap: break-word;
        font-size: 12px;
        display: flex;
        flex-direction: column;
      }
      .bot-message {
        background-color: #e3f2fd;
        color: #000;
        margin-right: auto;
        border-bottom-left-radius: 5px;
      }
      .user-message {
        background-color: #1a73e8;
        color: #fff;
        margin-left: auto;
        border-bottom-right-radius: 5px;
      }
      .timestamp {
        font-size: 9px;
        color: #666;
        margin-top: 4px;
        align-self: flex-end;
      }
      #chatInputContainer {
        display: flex;
        padding: 10px;
        background-color: #fff;
        border-top: 1px solid #ddd;
      }
      #chatInput {
        flex: 1;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
        color: #000;
        background-color: #fff;
        font-size: 12px;
      }
      #chatInput:focus {
        border-color: #1a73e8;
        outline: 2px solid #1a73e8;
      }
      #sendButton {
        margin-left: 8px;
        padding: 8px 12px;
        background-color: #1a73e8;
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 12px;
      }
      #sendButton:hover,
      #sendButton:active {
        background-color: #1557b0;
      }
      .typing-indicator {
        font-style: italic;
        color: #666;
        font-size: 12px;
      }
      hr {
        border: 0;
        height: 1px;
        background: #ccc;
        margin: 0.5rem 0 0 0;
      }
      .logo-img {
        height: 30px;
        vertical-align: middle;
        margin-right: 6px;
      }

      /* Hamburger Menu Icon */
      .hamburger {
        display: none;
        font-size: 24px;
        background: none;
        border: none;
        color: #000;
        cursor: pointer;
        padding: 8px;
      }

      /* Mobile-Specific Styles */
      @media (max-width: 768px) {
        header {
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          padding: 8px 12px;
        }
        header > div:first-child {
          margin-top: 0;
        }
        .logo-img {
          height: 24px;
        }
        .hamburger {
          display: block;
        }
        header .navigation {
          display: none;
        }
        header .navigation.active {
          display: flex;
          flex-direction: column;
          position: absolute;
          top: 100%;
          left: 0;
          right: 0;
          background-color: #fff;
          border-bottom: 1px solid #ccc;
          padding: 12px;
          z-index: 999;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        header .navigation.active nav,
        header .navigation.active div {
          display: flex;
          flex-direction: column;
        }
        header .navigation nav a,
        header .navigation div a,
        header .navigation div span {
          font-size: 14px;
          padding: 10px;
          text-align: left;
          width: 100%;
          border: none;
          border-radius: 0;
          border-bottom: 1px solid #eee;
        }
        header .navigation nav a:last-child,
        header .navigation div a:last-child,
        header .navigation div span:last-child {
          border-bottom: none;
        }
        header nav a,
        header div a {
          font-size: 12px;
          padding: 6px 10px;
        }
        section {
          padding: 8px;
        }
        h2 {
          font-size: 1.5rem;
        }
        p {
          font-size: 0.9rem;
        }
        #bb {
          padding: 8px;
          margin: 5px;
        }
        canvas {
          max-height: 300px;
        }
        #toolSections {
          flex-direction: column;
          gap: 6px;
        }
        .tool-box {
          flex-direction: column;
          align-items: stretch;
          padding: 6px;
        }
        .tool-box label,
        .tool-box select,
        .tool-box input,
        .tool-box button {
          width: 100%;
          font-size: 12px;
          padding: 6px;
        }
        #colorButtons {
          gap: 4px;
        }
        #colorButtons button {
          width: 28px;
          height: 28px;
        }
        #actionButtons button {
          font-size: 12px;
          padding: 6px 10px;
        }
        #infoContent {
          width: 95%;
          font-size: 11px;
        }
        #brushPreviewSection .grid {
          grid-template-columns: 1fr;
        }
        .brush-preview {
          padding: 8px;
        }
        .brush-preview h3 {
          font-size: 1rem;
        }
        .brush-preview p {
          font-size: 0.8rem;
        }
        .modal-dialog {
          margin: 0.5rem;
        }
        .modal-content {
          padding: 10px;
        }
        .modal-title {
          font-size: 1.2rem;
        }
        .modal-body {
          font-size: 0.9rem;
        }
        .modal-footer button {
          font-size: 0.9rem;
          padding: 8px;
        }
        #chatWindow {
          width: 95%;
          max-width: 300px;
          height: 350px;
          bottom: 60px;
          right: 5px;
        }
        #chatHeader {
          font-size: 12px;
          padding: 8px;
        }
        #chatClose {
          font-size: 16px;
        }
        #chatMessages {
          padding: 8px;
        }
        .message {
          font-size: 11px;
          padding: 6px;
        }
        .timestamp {
          font-size: 8px;
        }
        #chatInputContainer {
          padding: 8px;
        }
        #chatInput {
          font-size: 11px;
          padding: 6px;
        }
        #sendButton {
          font-size: 11px;
          padding: 6px 10px;
        }
      }

      @media (max-width: 480px) {
        header .navigation.active nav a,
        header .navigation.active div a,
        header .navigation.active div span {
          font-size: 12px;
          padding: 8px;
        }
        h2 {
          font-size: 1.2rem;
        }
        p {
          font-size: 0.8rem;
        }
        canvas {
          max-height: 250px;
        }
        #toolSections {
          gap: 4px;
        }
        .tool-box {
          padding: 5px;
        }
        .tool-box label,
        .tool-box select,
        .tool-box input,
        .tool-box button {
          font-size: 11px;
          padding: 5px;
        }
        #colorButtons button {
          width: 24px;
          height: 24px;
        }
        #actionButtons button {
          font-size: 11px;
          padding: 5px 8px;
        }
        #infoBox span {
          font-size: 16px;
        }
        #infoContent {
          font-size: 10px;
        }
        #chatButton {
          width: 40px;
          height: 40px;
          font-size: 18px;
        }
        #chatWindow {
          height: 300px;
          max-width: 280px;
        }
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col font-sans" style="background-color: #ffffff;">
    <main>
      <!-- Header -->
      <header class="bg-white border-b border-gray-200 px-8 py-2 flex flex-col sm:flex-row sm:items-start sm:justify-between sticky top-0 z-[1000]">
        <div class="sm:mt-[-6px] flex items-center">
          <img src="/static/logo.png" alt="Synesthetica Logo" class="logo-img" />
          <a href="#" class="text-3xl font-extrabold text-blue-600 hover:text-blue-700 transition">
            Synesthetica
          </a>
        </div>
        <button class="hamburger" onclick="toggleNav()">‚ò∞</button>
        <div class="navigation flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2 mt-2 sm:mt-0">
          <nav class="flex gap-3 flex-wrap justify-end">
            <a href="/about" class="border border-gray-300 rounded-full px-4 py-1.5 text-sm font-semibold text-red-500 hover:bg-gray-100 transition">
              About us
            </a>
            <a href="#" class="border border-gray-300 rounded-full px-4 py-1.5 text-sm font-semibold text-red-500 hover:bg-gray-100 transition flex items-center gap-1" onclick="toggleDrawingSection()">
              üé® Start <span>Drawing</span>
            </a>
            <a href="/pricing" class="border border-gray-300 rounded-full px-4 py-1.5 text-sm font-semibold text-red-500 hover:bg-gray-100 transition">
              Pricing
            </a>
            <a href="/support" class="border border-gray-300 rounded-full px-4 py-1.5 text-sm font-semibold text-red-500 hover:bg-gray-100 transition">
              Help
            </a>
            <a href="/admin" class="border border-gray-300 rounded-full px-4 py-1.5 text-sm font-semibold text-red-500 hover:bg-gray-100 transition">
              admin
          </nav>
          <div class="flex gap-3 flex-wrap justify-end">
            {% if user %}
              <span class="text-sm font-semibold text-gray-800 flex items-center gap-2">
                Welcome, {{ user.name }}
              </span>
              <a href="/logout" class="border border-gray-300 rounded-full px-4 py-1.5 text-sm font-semibold text-gray-800 flex items-center gap-2 hover:bg-gray-100 transition">
                üîì Logout
              </a>
            {% else %}
              <a href="/auth" rel="noopener" class="border border-gray-300 rounded-full px-4 py-1.5 text-sm font-semibold text-gray-800 flex items-center gap-2 hover:bg-gray-100 transition">
                üîí Login with Microsoft
              </a>
              <a href="/auth" rel="noopener" class="border border-gray-300 rounded-full px-4 py-1.5 text-sm font-semibold text-gray-800 flex items-center gap-2 hover:bg-gray-100 transition">
                üìÑ Sign Up with Microsoft
              </a>
            {% endif %}
          </div>
        </div>
      </header>

      <!-- Toast Notifications -->
      <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="drawingToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="3000">
          <div class="toast-header">
            <strong class="me-auto">Synesthetica</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">
            The drawing section is now open! Start creating your artwork.
          </div>
        </div>
        <div id="limitToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
          <div class="toast-header">
            <strong class="me-auto">Submission Limit Reached</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">
            You've reached the submission limit. Please <a href="/auth" class="text-primary">log in</a> or <a href="/auth" class="text-primary">sign up</a> to submit more.
          </div>
        </div>
        <div id="subscribeToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000">
          <div class="toast-header">
            <strong class="me-auto">Subscription Required</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">
            You've reached the submission limit for this month. <a href="/pricing" id="subscribeLink" class="text-primary">View Pricing</a> to continue.
          </div>
        </div>
      </div>

      <!-- Create Art Section -->
      <section id="createArtSection" class="max-w-4xl mx-auto py-12 px-4 flex flex-col items-center justify-center">
        <button class="inline-block bg-white text-black font-semibold py-3 px-6 rounded-full hover:bg-gray-200 transition duration-300 border border-gray-300 mb-8" onclick="toggleDrawingSection()">
          üé® Try Drawing
        </button>
        <h2 class="text-3xl font-semibold mb-8 text-black text-center">
          Create Art That Sings
        </h2>
        <p class="text-lg mb-12 text-black text-center">
          Synesthetica transforms your brush strokes into musical tones. Choose
          from unique brush shapes, adjust sizes, and pick colors that generate
          real-time piano-like
          <span id="seeMoreLink" onclick="toggleBrushPreview()" role="button" aria-expanded="false" aria-controls="brushPreviewSection">see more</span>
        </p>
      </section>

      <!-- Brush Preview Section -->
      <section id="brushPreviewSection" class="max-w-4xl mx-auto px-4 pb-12 hidden">
        <p class="text-lg mb-12 text-black text-center">
          sounds. Experience creativity like never before!
          <span id="seeLessLink" class="text-blue-600 cursor-pointer underline hover:text-blue-800 hidden" onclick="toggleBrushPreview()" role="button" aria-expanded="true" aria-controls="brushPreviewSection">see less</span>
        </p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="brush-preview bg-white bg-opacity-10 p-6 rounded-lg text-center">
            <h3 class="text-xl font-semibold mb-2 text-black">Round Brush</h3>
            <p class="text-sm text-black">Pure sine wave for a clean, smooth tone.</p>
          </div>
          <div class="brush-preview bg-white bg-opacity-10 p-6 rounded-lg text-center">
            <h3 class="text-xl font-semibold mb-2 text-black">Square Brush</h3>
            <p class="text-sm text-black">Harsh, digital square wave sound.</p>
          </div>
          <div class="brush-preview bg-white bg-opacity-10 p-6 rounded-lg text-center">
            <h3 class="text-xl font-semibold mb-2 text-black">Star Brush</h3>
            <p class="text-sm text-black">Rich harmonics at twice the frequency.</p>
          </div>
          <div class="brush-preview bg-white bg-opacity-10 p-6 rounded-lg text-center">
            <h3 class="text-xl font-semibold mb-2 text-black">Triangle Brush</h3>
            <p class="text-sm text-black">Soft, mellow triangle wave tone.</p>
          </div>
          <div class="brush-preview bg-white bg-opacity-10 p-6 rounded-lg text-center">
            <h3 class="text-xl font-semibold mb-2 text-black">Cross Brush</h3>
            <p class="text-sm text-black">Detuned frequency for a beating effect.</p>
          </div>
          <div class="brush-preview bg-white bg-opacity-10 p-6 rounded-lg text-center">
            <h3 class="text-xl font-semibold mb-2 text-black">Sawtooth Brush</h3>
            <p class="text-sm text-black">Bright, buzzy sawtooth wave.</p>
          </div>
          <div class="brush-preview bg-white bg-opacity-10 p-6 rounded-lg text-center">
            <h3 class="text-xl font-semibold mb-2 text-black">Spray Brush</h3>
            <p class="text-sm text-black">Complex, textured rounded saw tone.</p>
          </div>
        </div>
      </section>

      <!-- Drawing App -->
      <section id="drawing-app" class="max-w-5xl mx-auto p-4 mb-12">
        <div id="bb">
          <h1 class="text-2xl md:text-3xl font-bold text-center mb-4 text-black">
            <img src="/static/logo2.png" alt="SynestheticSounds Logo" style="height: 50px; vertical-align: middle" />
            Welcome to Synesthetic Sounds
          </h1>

          <!-- Toolbar -->
          <div id="toolSections">
            <div class="tool-box">
              <button onclick="undo()">‚Ü©Ô∏è Undo</button>
              <button onclick="redo()">‚Ü™Ô∏è Redo</button>
              <button onclick="saveImage()">üíæ Save</button>
              <button onclick="clearCanvas()">üóëÔ∏è Clear</button>
            </div>
            <div class="tool-box" title="Multiple Brush Shapes | Affects waveform harmonics">
              <label title="Adjustable Brush Size (4px to 64px) controls amplitude">
                Brush Size: <br />
                <input type="range" id="brushSizeSlider" min="4" max="64" value="16" />
              </label>
              <label>
                Brush Type: <br />
                <select id="toolSelect" data-bs-toggle="tooltip" title="Select a waveform shape to affect how sound is blended.">
                  <option value="line" title="Basic sawtooth wave">Line</option>
                  <option value="square" title="Square wave with strong harmonics">Square</option>
                  <option value="cross" title="Complex FM synthesis tones">Cross</option>
                  <option value="round" title="Smooth sine wave tones">Round</option>
                  <option value="star" title="Bell-like harmonic overtones">Star</option>
                  <option value="spray" title="Noise-based texture sounds">Spray</option>
                  <option value="triangle" title="Clean triangle wave">Triangle</option>
                  <option value="sawtooth" title="Rich harmonic content">Sawtooth</option>
                </select>
              </label>
            </div>
            <div class="tool-box">
              <div id="colorButtons">
                <div><button style="background-color: #80e000" onclick="setColor('#80E000')"></button><br /><span>C4</span></div>
                <div><button style="background-color: #006073" onclick="setColor('#006073')"></button><br /><span>D4</span></div>
                <div><button style="background-color: #7e00d9" onclick="setColor('#7e00d9')"></button><br /><span>E4</span></div>
                <div><button style="background-color: #9f1aec" onclick="setColor('#9F1AEC')"></button><br /><span>F4</span></div>
                <div><button style="background-color: #d91a80" onclick="setColor('#D91A80')"></button><br /><span>G4</span></div>
                <div><button style="background-color: #f95700" onclick="setColor('#F95700')"></button><br /><span>A4</span></div>
                <div><button style="background-color: #ffff33" onclick="setColor('#ffff33')"></button><br /><span>B4</span></div>
                <div><button style="background-color: #3399cc" onclick="setColor('#3399CC')"></button><br /><span>C5</span></div>
              </div>
              Color Picker: <input type="color" id="colorPicker" value="#ff0000" data-bs-toggle="tooltip" title="Pick a color to assign a musical note." />
            </div>
          </div>

          <!-- Instructions and Info Button -->
          <div style="font-size: 14px; padding: 10px">
            <p style="text-align: center; font-weight: bold">
              SynestheticSounds is a creative painting application that not only
              lets you draw with various artistic brushes, but also generates
              sound based on the colors and shapes you use. It's a unique way to
              visualize and sonify your creativity.
            </p>
            <div id="infoBox">
              <span>‚ÑπÔ∏è</span>
              <div id="infoContent">
                <strong>üé® How to Use This App</strong><br /><br />
                <ul class="list-unstyled">
                  <li><b>üé® Color = Note & Frequency:</b> Each color corresponds to a specific musical note and its frequency. Try different hues to hear different pitches.</li>
                  <li><b>üñåÔ∏è Brush Type = Blend:</b> The brush type controls how tones blend. Choose shapes like round, triangle, or sawtooth to alter the sound character.</li>
                  <li><b>üñºÔ∏è Canvas Area = Sound Weight:</b> The more you paint with a specific color, the louder and more prominent that note becomes in the final mix.</li>
                  <li><b>‚ñ∂Ô∏è Submit Drawing:</b> Click this to generate and play back your audio composition based on your visual artwork.</li>
                </ul>
                <p class="mb-0 text-muted" style="font-size: 0.85em">
                  Tip: Mix brush types and colors to compose rich soundscapes visually!
                </p>
              </div>
            </div>
          </div>

          <!-- Canvas -->
          <div id="canvasContainer">
            <canvas id="canvas" width="1000" height="500"></canvas>
          </div>
          <div style="text-align: center">
            <span style="position: relative; display: inline-flex; justify-content: center;">Time (sec)</span>
          </div>

          <!-- Action Buttons -->
          <div id="actionButtons">
            <button onclick="submitDrawing()" data-bs-toggle="tooltip" title="Click to generate sound from your drawing.">
              üéº Submit Drawing
            </button>
            <button onclick="downloadAudio()" data-bs-toggle="tooltip" title="Save your generated audio as a WAV file.">
              üîä Download Audio
            </button>
            <button id="subscribeButton" style="display: none;" onclick="subscribe()" data-bs-toggle="tooltip" title="Subscribe to continue using Synesthetica.">
              üí≥ Subscribe
            </button>
          </div>

          <br />
          <audio id="player" controls></audio>
        </div>
      </section>
    </main>

    <!-- Onboarding Modal -->
    <div class="modal fade" id="onboardingModal" tabindex="-1" aria-labelledby="onboardingLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content rounded-4 shadow-lg">
          <div class="modal-header border-0">
            <h5 class="modal-title" id="onboardingLabel">üé∂ Welcome to SynestheticSounds</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ol class="list-group list-group-numbered">
              <li class="list-group-item"><strong>Pick a Color:</strong> Each color represents a musical note. Choose one from the palette.</li>
              <li class="list-group-item"><strong>Select a Brush:</strong> Change how the sound blends using different waveforms (round, sawtooth, triangle).</li>
              <li class="list-group-item"><strong>Start Drawing:</strong> The more color you add, the louder that note will sound.</li>
              <li class="list-group-item"><strong>Submit Drawing:</strong> Click the play button to hear your artwork come alive!</li>
            </ol>
          </div>
          <div class="modal-footer border-0">
            <button type="button" class="btn btn-primary w-100" data-bs-dismiss="modal">Let's Get Started!</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Window -->
    <div id="chatWindow">
      <div id="chatHeader">
        <span>Synesthetica Support</span>
        <button id="chatClose">√ó</button>
      </div>
      <div id="chatMessages">
        <!-- Chat messages will be added via JavaScript -->
      </div>
      <div id="chatInputContainer">
        <input type="text" id="chatInput" placeholder="Type your question..." />
        <button id="sendButton">Send</button>
      </div>
    </div>

    <!-- Chat Icon Button -->
    <button id="chatButton" onclick="toggleChat()" title="Customer Support">
      üí¨
    </button>

    <!-- Footer -->
    <footer class="py-6 text-center">
      <p class="text-sm text-black">¬© 2025 Synesthetica. All rights reserved.</p>
      <p class="text-sm text-black">
        <a href="/privacy" class="text-blue-600 hover:text-blue-800">Privacy Policy</a> |
        <a href="/support" class="text-blue-600 hover:text-blue-800">Support</a>
      </p>
    </footer>

    <!-- JavaScript -->
    <script>
      // Toggle Navigation Menu for Mobile
      function toggleNav() {
        const navigation = document.querySelector(".navigation");
        const hamburger = document.querySelector(".hamburger");
        navigation.classList.toggle("active");
        hamburger.textContent = navigation.classList.contains("active") ? "‚úï" : "‚ò∞";
      }

      // Toggle Drawing Section
      function toggleDrawingSection() {
        const drawingSection = document.getElementById("drawing-app");
        const toast = new bootstrap.Toast(document.getElementById("drawingToast"));
        const isHidden = !drawingSection.classList.contains("visible");
        drawingSection.classList.toggle("visible");
        if (isHidden) {
          toast.show();
        }
      }

      // Toggle Brush Preview with Debounce and ARIA
      let isToggling = false;
      function toggleBrushPreview() {
        if (isToggling) return;
        isToggling = true;
        
        const brushPreviewSection = document.getElementById("brushPreviewSection");
        const seeMoreLink = document.getElementById("seeMoreLink");
        const seeLessLink = document.getElementById("seeLessLink");

        // Debugging logs
        console.log("toggleBrushPreview called");
        console.log("brushPreviewSection:", brushPreviewSection);
        console.log("seeMoreLink:", seeMoreLink);
        console.log("seeLessLink:", seeLessLink);

        if (!brushPreviewSection || !seeMoreLink || !seeLessLink) {
          console.error("One or more elements not found!");
          isToggling = false;
          return;
        }

        const isHidden = brushPreviewSection.classList.contains("hidden");
        brushPreviewSection.classList.toggle("hidden");
        seeMoreLink.classList.toggle("hidden");
        seeLessLink.classList.toggle("hidden");
        seeMoreLink.setAttribute("aria-expanded", isHidden ? "true" : "false");
        seeLessLink.setAttribute("aria-expanded", isHidden ? "true" : "false");

        if (!brushPreviewSection.classList.contains("hidden")) {
          brushPreviewSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }

        setTimeout(() => {
          isToggling = false;
        }, 300);
      }

      // Chat Functions
      function toggleChat() {
        const chatWindow = document.getElementById("chatWindow");
        if (chatWindow.style.display === "flex") {
          chatWindow.style.display = "none";
        } else {
          chatWindow.style.display = "flex";
          scrollToBottom();
        }
      }

      function addMessage(text, isUser = false) {
        const messages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${isUser ? "user-message" : "bot-message"}`;
        
        const textSpan = document.createElement("span");
        textSpan.className = "message-text";
        textSpan.textContent = text;
        
        const now = new Date();
        const timeString = now.getHours().toString().padStart(2, "0") + ":" + now.getMinutes().toString().padStart(2, "0");
        const timestampSpan = document.createElement("span");
        timestampSpan.className = "timestamp";
        timestampSpan.textContent = timeString;
        
        messageDiv.appendChild(textSpan);
        messageDiv.appendChild(timestampSpan);
        messages.appendChild(messageDiv);
        scrollToBottom();
      }

      function scrollToBottom() {
        const messages = document.getElementById("chatMessages");
        messages.scrollTop = messages.scrollHeight;
      }

      function getBotResponse(question) {
        const lowerQuestion = question.toLowerCase();
        if (lowerQuestion.includes("hello") || lowerQuestion.includes("hi")) {
          return "Hello! Welcome to Synesthetica Support. How can I assist you with drawing, sounds, subscriptions, or signing up today?";
        } else if (lowerQuestion.includes("draw") || lowerQuestion.includes("start")) {
          return "To start drawing, click 'Try Drawing' on the homepage or header. Select a brush, color, and paint on the canvas. The more you use a color, the louder its note in the sound!";
        } else if (lowerQuestion.includes("submit") || lowerQuestion.includes("limit")) {
          return "If you can't submit, you've likely hit the daily limit (5 for guests, 10 for logged-in users). Log in or sign up for more, or subscribe for unlimited. Ensure your drawing has colors!";
        } else if (lowerQuestion.includes("subscribe")) {
          return "Click the 'Pricing' link in the header or visit our pricing page to subscribe to the Basic Usage-Based plan and get unlimited submissions.";
        } else if (lowerQuestion.includes("color") || lowerQuestion.includes("sound")) {
          return "Colors represent musical notes: e.g., green is C4. Brush types affect sound texture (round for smooth, sawtooth for buzzy). Submit to hear your artwork!";
        } else if (lowerQuestion.includes("login") || lowerQuestion.includes("microsoft")) {
          return "Log in with Microsoft via the 'Login with Microsoft' link in the header. This unlocks more submissions and personalized features.";
        } else if (lowerQuestion.includes("signup") || lowerQuestion.includes("sign up")) {
          return "Sign up with Microsoft using the 'Sign Up with Microsoft' link in the header. You'll be prompted to create a Microsoft account if you don't have one, then get access to more submissions!";
        } else if (lowerQuestion.includes("help") || lowerQuestion.includes("support")) {
          return "I'm here for quick help! For advanced issues, email support@synesthetica.com or visit our Support page. What specific question do you have?";
        } else {
          return "That's an interesting question! For now, try asking about drawing, submitting, subscriptions, signing up, or colors. If you need more help, email support@synesthetica.com.";
        }
      }

      document.getElementById("chatClose").addEventListener("click", toggleChat);
      document.getElementById("sendButton").addEventListener("click", sendMessage);
      document.getElementById("chatInput").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
          sendMessage();
        }
      });

      function sendMessage() {
        const input = document.getElementById("chatInput");
        const question = input.value.trim();
        if (!question) return;

        const messages = document.getElementById("chatMessages");
        const isFirstMessage = messages.children.length === 0;

        addMessage(question, true);
        input.value = "";

        addMessage("Typing...", false);
        setTimeout(() => {
          const lastMessage = document.querySelector("#chatMessages .message:last-child");
          if (lastMessage && lastMessage.textContent.includes("Typing...")) {
            lastMessage.remove();
          }
          
          if (isFirstMessage) {
            addMessage("Hello! I'm here to help with Synesthetica. Ask me anything about drawing, sounds, subscriptions, or signing up.", false);
          }
          const response = getBotResponse(question);
          addMessage(response, false);
        }, 1000);
      }

      // Canvas & Drawing Logic
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const colorPicker = document.getElementById("colorPicker");
      const toolSelect = document.getElementById("toolSelect");
      const brushSizeSlider = document.getElementById("brushSizeSlider");
      const colorButtons = document.querySelectorAll("#colorButtons button");

      let drawing = false;
      let hasMoved = false;
      let currentColor = colorPicker.value;
      let brushSize = parseInt(brushSizeSlider.value, 10);
      let tool = toolSelect.value;
      let undoStack = [];
      let redoStack = [];
      let subscribeUrl = "/pricing";

      function resizeCanvas() {
        const width = Math.min(window.innerWidth - 20, 1000);
        const height = Math.min(window.innerHeight * 0.5, 300);
        canvas.width = width;
        canvas.height = height;
        if (undoStack.length > 0) {
          restoreState(undoStack[undoStack.length - 1]);
        } else {
          saveState();
        }
        drawXAxisLabels();
      }

      window.addEventListener("resize", resizeCanvas);
      window.addEventListener("load", resizeCanvas);

      // Prevent pinch-to-zoom on mobile
      document.addEventListener('gesturestart', (e) => {
        e.preventDefault();
      });

      // Mouse Events
      canvas.addEventListener("mousedown", (e) => {
        drawing = true;
        hasMoved = false;
        draw(e);
      });
      canvas.addEventListener("mouseup", () => {
        drawing = false;
        ctx.beginPath();
        saveState();
      });
      canvas.addEventListener("mousemove", draw);

      // Touch Events
      canvas.addEventListener("touchstart", (e) => {
        e.preventDefault();
        drawing = true;
        hasMoved = false;
        draw(e.touches[0]);
      }, { passive: false });
      canvas.addEventListener("touchmove", (e) => {
        e.preventDefault();
        draw(e.touches[0]);
      }, { passive: false });
      canvas.addEventListener("touchend", () => {
        drawing = false;
        ctx.beginPath();
        saveState();
      });

      colorPicker.addEventListener("input", () => (currentColor = colorPicker.value));
      brushSizeSlider.addEventListener("input", () => (brushSize = parseInt(brushSizeSlider.value, 10)));
      toolSelect.addEventListener("change", () => (tool = toolSelect.value));
      function setColor(color) {
        currentColor = color;
        colorPicker.value = color;
      }

      function draw(e) {
        if (!drawing) return;
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const x = ((e.clientX || e.touches[0].clientX) - rect.left) * scaleX;
        const y = ((e.clientY || e.touches[0].clientY) - rect.top) * scaleY;

        ctx.fillStyle = currentColor;
        ctx.strokeStyle = currentColor;

        if (tool === "spray") {
          const sprayDensity = Math.max(brushSize, 10);
          for (let i = 0; i < sprayDensity; i++) {
            const offsetX = (Math.random() - 0.5) * brushSize * 2;
            const offsetY = (Math.random() - 0.5) * brushSize * 2;
            ctx.fillRect(x + offsetX, y + offsetY, 1, 1);
          }
        } else {
          switch (tool) {
            case "square":
              ctx.fillRect(x, y, brushSize, brushSize);
              break;
            case "line":
              ctx.lineWidth = brushSize;
              if (!hasMoved) {
                ctx.beginPath();
                ctx.moveTo(x, y);
                hasMoved = true;
              } else {
                ctx.lineTo(x, y);
                ctx.stroke();
              }
              break;
            case "round":
              ctx.beginPath();
              ctx.arc(x, y, brushSize / 2, 0, Math.PI * 2);
              ctx.fill();
              break;
            case "star":
              drawStar(x, y, 5, brushSize / 2, brushSize);
              break;
            case "cross":
              drawCross(x, y, brushSize);
              break;
            case "triangle":
              drawTriangle(x, y, brushSize);
              break;
            case "sawtooth":
              drawSawtooth(x, y, brushSize);
              break;
          }
        }
      }

      function drawStar(cx, cy, spikes, innerRadius, outerRadius) {
        let rot = (Math.PI / 2) * 3;
        let step = Math.PI / spikes;
        ctx.beginPath();
        ctx.moveTo(cx, cy - outerRadius);
        for (let i = 0; i < spikes; i++) {
          ctx.lineTo(cx + Math.cos(rot) * outerRadius, cy + Math.sin(rot) * outerRadius);
          rot += step;
          ctx.lineTo(cx + Math.cos(rot) * innerRadius, cy + Math.sin(rot) * innerRadius);
          rot += step;
        }
        ctx.lineTo(cx, cy - outerRadius);
        ctx.closePath();
        ctx.fill();
      }

      function drawCross(x, y, size) {
        ctx.beginPath();
        ctx.moveTo(x - size / 2, y);
        ctx.lineTo(x + size / 2, y);
        ctx.moveTo(x, y - size / 2);
        ctx.lineTo(x, y + size / 2);
        ctx.stroke();
      }

      function drawTriangle(x, y, size) {
        const height = (size * Math.sqrt(3)) / 2;
        ctx.beginPath();
        ctx.moveTo(x, y - height / 2);
        ctx.lineTo(x - size / 2, y + height / 2);
        ctx.lineTo(x + size / 2, y + height / 2);
        ctx.closePath();
        ctx.fill();
      }

      function drawSawtooth(x, y, size) {
        const teeth = 4;
        const width = size / 4;
        const height = size / 4;
        const toothWidth = width / teeth;
        ctx.beginPath();
        ctx.moveTo(x, y);
        for (let i = 0; i < teeth; i++) {
          ctx.lineTo(x + i * toothWidth + toothWidth / 2, y - height);
          ctx.lineTo(x + (i + 1) * toothWidth, y);
        }
        ctx.stroke();
      }

      function saveState() {
        drawXAxisLabels();
        undoStack.push(canvas.toDataURL());
        if (undoStack.length > 50) undoStack.shift();
        redoStack.length = 0;
      }

      function undo() {
        if (undoStack.length > 1) {
          redoStack.push(undoStack.pop());
          restoreState(undoStack[undoStack.length - 1]);
        }
      }

      function redo() {
        if (redoStack.length > 0) {
          const state = redoStack.pop();
          restoreState(state);
          undoStack.push(state);
        }
      }

      function restoreState(stateURL) {
        const img = new Image();
        img.onload = () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0);
        };
        img.src = stateURL;
      }

      function saveImage() {
        const link = document.createElement("a");
        link.download = "drawing.png";
        link.href = canvas.toDataURL();
        link.click();
      }

      function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        saveState();
        drawXAxisLabels();
      }

      function subscribe() {
        window.location.href = "/pricing";
      }

      async function submitDrawing() {
        if (undoStack.length <= 1) {
          alert("Please draw something before submitting!");
          return;
        }
        const dataURL = canvas.toDataURL("image/png");
        const brush = document.getElementById("toolSelect").value;
        try {
          const res = await fetch("/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image: dataURL, brush: brush }),
          });
          const data = await res.json();
          if (data.error) {
            if (data.error.includes("submission limit")) {
              if (data.subscribe) {
                subscribeUrl = "/pricing";
                document.getElementById("subscribeButton").style.display = "block";
                document.getElementById("subscribeLink").href = subscribeUrl;
                const toast = new bootstrap.Toast(document.getElementById("subscribeToast"));
                toast.show();
              } else {
                const toast = new bootstrap.Toast(document.getElementById("limitToast"));
                toast.show();
              }
            } else {
              alert(data.error);
            }
            return;
          }
          const player = document.getElementById("player");
          player.src = data.url + "?t=" + new Date().getTime();
          player.play();
        } catch (error) {
          console.error("Error submitting drawing:", error);
          alert("Failed to generate audio. Please try again or check your drawing.");
        }
      }

      function downloadAudio() {
        const player = document.getElementById("player");
        if (!player.src) {
          alert("No audio available! Please submit a drawing first.");
          return;
        }
        const link = document.createElement("a");
        link.href = player.src;
        link.download = "drawing_sound.wav";
        link.click();
      }

      function drawXAxisLabels() {
        const totalSeconds = 60;
        const interval = 5;
        const numberOfLabels = totalSeconds / interval + 1;
        const labelY = canvas.height - 5;
        const spacing = canvas.width / (numberOfLabels - 1);
        ctx.save();
        ctx.font = "12px Arial";
        ctx.fillStyle = "#333";
        ctx.textAlign = "center";
        for (let i = 0; i < numberOfLabels; i++) {
          const x = i * spacing;
          const label = (i * interval).toFixed(1);
          ctx.fillText(label, x, labelY);
          ctx.beginPath();
          ctx.moveTo(x, labelY - 5);
          ctx.lineTo(x, labelY - 15);
          ctx.strokeStyle = "#888";
          ctx.stroke();
        }
        ctx.restore();
      }

      // Initial state
      saveState();

      // Bootstrap init
      document.addEventListener("DOMContentLoaded", () => {
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltipTriggerList.forEach((el) => new bootstrap.Tooltip(el));
        const modal = new bootstrap.Modal(document.getElementById("onboardingModal"));
        if (!sessionStorage.getItem("onboardingSeen")) {
          modal.show();
          sessionStorage.setItem("onboardingSeen", "true");
        }
      });
    </script>
  </body>
</html>

